<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        const cl = (str) => console.log(str)
        const el = (str) => document.getElementById(str)
        getRtnJson = async (url, header) => {
            const response = await fetch(url, {
                method: 'get',
                headers: header,
                mode: 'no-cors'

            });
            let json = await response.json();
            return json
        }
        postRtnJson = async (url, body, header) => {
            const response = await fetch(url, {
                method: 'post',
                body: JSON.stringify(body),
                headers: header,
                credentials: 'include'
            });
            let json = await response.json();
            return json

        }
        const formatFileSize = function (bytes) {
            const sufixes = ['B', 'kB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sufixes[i]}`;
        }
        async function uploadFile() {
            var file = el("file1").files[0];
            cl(file.name + " | " + formatFileSize(file.size) + " | " + file.type)
            cl(postRtnJson('https://untitled-ia3c99utajdw.runkit.sh/'), {
                name: file.name,
                size: file.size,
                typeL: file.type
            })
            let info = await postRtnJson('https://www.notion.so/api/v3/getUploadFileUrl', {
                "bucket": "secure",
                "name": file.name,
                "contentType": file.type,
                "record": {
                    "table": "block",
                    "id": "a6315f71-8197-41af-8854-96a33bc0b155",
                    "spaceId": "993c3a7f-e1f7-4342-974a-f8abf65c40d7"
                },
                "supportExtraHeaders": true,
                "contentLength": file.size
            }, {
                "content-type": "application/json",
                "cookie": "logglytrackingsession=1abcc622-b80e-425b-bd5e-77654841eb20; NEXT_LOCALE=en-US; notion_experiment_device_id=be5d61a3-d85b-47bd-adca-b9c7880abe34; g_state={\"i_l\":0}; token_v2=96b948777a31d25f3ecfbd6fc572fd43218558b9ffac48099bc4edf579348f414d973aba42e5055b4ddcb69e5e1af1a049676a8c8c9f56a8cddfbfd821e2b0fe1d68033f02522c1b7b868583ef09; notion_user_id=db17c83b-afcf-46e4-a5a8-ce99f167c637; notion_users=[%22db17c83b-afcf-46e4-a5a8-ce99f167c637%22]; notion_browser_id=7919159a-b642-4ae9-a42c-3015b53e04c5; notion_cookie_consent={%22id%22:%2248222933-2b88-440d-a68f-2340c022bb48%22%2C%22permission%22:{%22necessary%22:true%2C%22targeting%22:true%2C%22preference%22:true%2C%22performance%22:true}%2C%22policy_version%22:%22v5%22}; _gcl_au=1.1.1090681837.1661566953; cb_user_id=null; cb_group_id=null; cb_anonymous_id=%2251ac1758-684a-44fb-8360-cab9f87bd0c0%22; mutiny.user.token=3c0acb29-a63c-44b3-83f5-8dd861e49fe6; mutiny.defaultOptOut=true; mutiny.optOut=; mutiny.optIn=true; _ga=GA1.1.932389555.1664288357; _ga_9ZJ8CB186L=GS1.1.1664288356.1.1.1664288356.60.0.0; _mkto_trk=id:414-XMY-838&token:_mch-www.notion.so-1664288356716-48733; notion_locale=en-US/autodetect; notion_check_cookie_consent=false; __cf_bm=1IPYoJMpxjuLPYqJkM2heDATopWLwWuj.anMPxdax9M-1667439571-0-AeyZAD35NwSoz/G/C61elEMm92L96fdbvDJxVRbiF96/ZobhEx+Mc527n1pzGydOnC/HKF6eE69JO+aqbopkEWk=; intercom-session-gpfdrxfd=R0FvQ01hQTh0MzN2N05VOSt4M1VzNEpiTk9LNVNuQlFnQ2NuMWNXUy84Yko0TTM4ckxlU1dhZnJIbWlBcllhMC0tMU5pTlRVRWg1dlRvQzFzRnArRndCdz09--79bb1b1827109cf896d3877964be3cb0af072511; amp_af43d4=7919159ab6424ae9a42c3015b53e04c5.ZGIxN2M4M2JhZmNmNDZlNGE1YThjZTk5ZjE2N2M2Mzc=..1ggti8otc.1ggtic6bs.ba3.2mv.e12",
            })
            let header = {}
            header[`${info.putHeaders[0].name}`] = info.putHeaders[0].value
            header[`${info.putHeaders[1].name}`] = info.putHeaders[1].value
            cl(header)


            var ajax = new XMLHttpRequest();
            ajax.upload.addEventListener("progress", progressHandler, false);
            ajax.addEventListener("load", completeHandler, false);
            ajax.addEventListener("error", errorHandler, false);
            ajax.addEventListener("abort", abortHandler, false);
            ajax.open("PUT", "https://s3.us-west-2.amazonaws.com/secure.notion-static.com/e45315c2-9d73-401a-9aae-572f5c3fb554/0.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221105%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20221105T060646Z&X-Amz-Expires=86400&X-Amz-Signature=c3e591e241edef360c52bdce0a9cd13ee3fcdf02b16e57e61253352de941aa25&X-Amz-SignedHeaders=content-length%3Bhost%3Bx-amz-tagging&x-amz-storage-class=INTELLIGENT_TIERING&x-id=PutObject");
            ajax.setRequestHeader('Content-Length', '9692204')
            ajax.setRequestHeader('x-amz-tagging', 'source=UserUpload&env=production&creator=notion_user%3Adb17c83b-afcf-46e4-a5a8-ce99f167c637%3A993c3a7f-e1f7-4342-974a-f8abf65c40d7%3Aa6315f71-8197-41af-8854-96a33bc0b155')
            ajax.send(file);
        }

        function progressHandler(event) {
            el("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
            var percent = (event.loaded / event.total) * 100;
            el("progressBar").value = Math.round(percent);
            el("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
        }

        function completeHandler(event) {
            el("status").innerHTML = event.target.responseText;
            el("progressBar").value = 0; //wil clear progress bar after successful upload
        }

        function errorHandler(event) {
            el("status").innerHTML = "Upload Failed";
        }

        function abortHandler(event) {
            el("status").innerHTML = "Upload Aborted";
        }

    </script>
    <h2>HTML5 File Upload Progress Bar Tutorial</h2>
    <form id="upload_form" enctype="multipart/form-data" method="post">
        <input type="file" name="file1" id="file1" onchange="uploadFile()"><br>
        <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
        <h3 id="status"></h3>
        <p id="loaded_n_total"></p>
    </form>
</body>

</html>